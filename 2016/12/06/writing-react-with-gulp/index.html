<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      纵享丝滑 | React with gulp | Kyrie On 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="kyrieliu">
    
    

    <meta name="description" content="Node.js首先是肯定要有node滴（这不是废话吗Orz…），如果还没有安装的话请自行询问你最喜欢的搜索引擎，相信她一定会很优雅的告诉你如何在或Windows或Mac或Linux上安装Node哒。
Initialize Your Project进入项目的目录，然后 cnpm init，根据命令行的提示创建项目的package.json文件，当然了，你也可以自己手动创建这个文件（讲道理，应该很少人">
<meta property="og:type" content="article">
<meta property="og:title" content="纵享丝滑 | React with gulp | Kyrie On">
<meta property="og:url" content="http://kyrieliu.cn/huno/2016/12/06/writing-react-with-gulp/index.html">
<meta property="og:site_name" content="Kyrie On">
<meta property="og:description" content="Node.js首先是肯定要有node滴（这不是废话吗Orz…），如果还没有安装的话请自行询问你最喜欢的搜索引擎，相信她一定会很优雅的告诉你如何在或Windows或Mac或Linux上安装Node哒。
Initialize Your Project进入项目的目录，然后 cnpm init，根据命令行的提示创建项目的package.json文件，当然了，你也可以自己手动创建这个文件（讲道理，应该很少人">
<meta property="og:updated_time" content="2016-12-14T01:30:35.553Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="纵享丝滑 | React with gulp | Kyrie On">
<meta name="twitter:description" content="Node.js首先是肯定要有node滴（这不是废话吗Orz…），如果还没有安装的话请自行询问你最喜欢的搜索引擎，相信她一定会很优雅的告诉你如何在或Windows或Mac或Linux上安装Node哒。
Initialize Your Project进入项目的目录，然后 cnpm init，根据命令行的提示创建项目的package.json文件，当然了，你也可以自己手动创建这个文件（讲道理，应该很少人">
    
    
    
      <link rel="icon" type="image/x-icon" href="/huno/favicon.png">
    
    <link rel="stylesheet" href="/huno/css/uno.css">
    <link rel="stylesheet" href="/huno/css/highlight.css">
    <link rel="stylesheet" href="/huno/css/archive.css">
    <link rel="stylesheet" href="/huno/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">Kyrie On</a></h1>
        <hr class="panel-cover__divider" />

        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/huno/#blog" title="" class="blog-button">首页</a></li>
              
                
                <li class="navigation__item"><a href="/huno/archive" title="" class="">归档</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">纵享丝滑 | React with gulp</h1>

    

    <div class="post-meta">
      <time datetime="2016-12-06" class="post-meta__date date">2016-12-06</time> 

      <span class="post-meta__tags tags">

          
            <font class="categories">
            &#8226; 分类:
            <a class="categories-link" href="/huno/categories/fe/">fe</a>
            </font>
          

          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <h3 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h3><p>首先是肯定要有node滴（这不是废话吗Orz…），如果还没有安装的话请自行询问你最喜欢的搜索引擎，相信她一定会很优雅的告诉你如何在或Windows或Mac或Linux上安装Node哒。</p>
<h3 id="Initialize-Your-Project"><a href="#Initialize-Your-Project" class="headerlink" title="Initialize Your Project"></a>Initialize Your Project</h3><p>进入项目的目录，然后 <strong>cnpm init</strong>，根据命令行的提示创建项目的package.json文件，当然了，你也可以自己手动创建这个文件（讲道理，应该很少人会这么做吧…）。我用的是<del>npm</del> cnpm，它在国内可以完美的代替npm，并且获得更快的包安装速度，详情请访问<a href="https://npm.taobao.org/" target="_blank" rel="external">淘宝镜像官网。</a>  </p>
<h3 id="Install-Gulp"><a href="#Install-Gulp" class="headerlink" title="Install Gulp"></a>Install Gulp</h3><p>接下来就要安装gulp了，我首先进行全局安装: <strong>cnpm install -g gulp</strong>。<br>全局安装的目的是为了通过它来执行gulp任务。<br>Next，本地安装: <strong>cnpm install –save-dev gulp</strong>  </p>
<p>安装完成之后打开package.json文件，就会发现gulp被写在了devDependencies字段里，成为项目的开发阶段依赖。本地安装gulp的目的是为了成功的用gulp插件。  </p>
<h3 id="Install-Gulp-Plugins"><a href="#Install-Gulp-Plugins" class="headerlink" title="Install Gulp Plugins"></a>Install Gulp Plugins</h3><p>Gulp是一款用来实现自动化的构建工具，诸如压缩代码、合并脚本、自动刷新等任务，都是通过gulp在项目中调用各种各样的插件来实现的。正所谓工欲善其事必先利其器，工欲利其器必先get其器，先来安装这些插件吧 ↓<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cnpm install --save-dev browserify vinyl-source-stream babelify babel-preset-es2015 babel-preset-react gulp-streamify gulp-uglifyjs gulp-connect</div></pre></td></tr></table></figure></p>
<p>一口气装了这么多插件，他们都是干什么的呢？  </p>
<ol>
<li>browserify: 实现浏览器端的模块和依赖管理——约定用require()来引用模块，用module.exports来导出模块。</li>
<li>vinyl-source-stream: 这个插件的作用是转换流模式，如果我们需要将gulp及gulp插件和常规的可读流一起使用，就需要先把可读流转换为vinyl。  </li>
<li>babelify, babel-preset-es2015, babel-preset-react: 用来编译es6以及react的jsx为浏览器可以识别的js。  </li>
<li>gulp-streamify: 将当前插件的输出转化为可读流，使得其后的只能操作可读流的插件正常工作。  </li>
<li>gulp-connect: 起服务器+自动刷新的一条龙服务。</li>
<li>gulp-uglifyjs: 看名字就知道了，丑化js。</li>
</ol>
<h3 id="Edit-your-Gulpfile-js"><a href="#Edit-your-Gulpfile-js" class="headerlink" title="Edit your Gulpfile.js"></a>Edit your Gulpfile.js</h3><p>gulp会根据gulpfile.js这个文件去执行用户自定义的gulp任务，所以这是整个gulp构建中最重要的一步。<br>Talk is cheap, show u the code:  </p>
<pre><code class="javascript"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);
<span class="keyword">var</span> connect = <span class="built_in">require</span>(<span class="string">'gulp-connect'</span>);
<span class="keyword">var</span> browserify = <span class="built_in">require</span>(<span class="string">'browserify'</span>);
<span class="keyword">var</span> source = <span class="built_in">require</span>(<span class="string">'vinyl-source-stream'</span>);
<span class="keyword">var</span> babelify = <span class="built_in">require</span>(<span class="string">'babelify'</span>);
<span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglifyjs'</span>);
<span class="keyword">var</span> streamify = <span class="built_in">require</span>(<span class="string">'gulp-streamify'</span>);

gulp.task(<span class="string">'connect'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{<span class="comment">//起服务器</span>
        connect.server({
                <span class="attr">root</span>: <span class="string">'./'</span>,
                <span class="attr">port</span>: <span class="string">'3000'</span>,
                <span class="attr">livereload</span>: <span class="literal">true</span>,
                <span class="attr">host</span>: <span class="string">'localhost'</span>
        });
});

gulp.task(<span class="string">'bundle'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
        <span class="keyword">return</span> browserify({<span class="attr">entries</span>: <span class="string">'./src/main.js'</span>, <span class="attr">extensions</span>: [<span class="string">'jsx'</span>], <span class="attr">debug</span>: <span class="literal">true</span>})
                .transform(babelify,{
                        <span class="attr">presets</span>: [<span class="string">'es2015'</span>,<span class="string">'react'</span>]
                })
                <span class="comment">//.transform(require('browserify-shim'))</span>
                .bundle()
                .pipe(source(<span class="string">'bundle.js'</span>))
                .pipe(streamify(uglify()))
                .pipe(gulp.dest(<span class="string">'./dist'</span>))
                .pipe(connect.reload());
});

gulp.task(<span class="string">'watch'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
        <span class="keyword">var</span> watcher = gulp.watch([<span class="string">'./src/*.js'</span>,<span class="string">'./src/*/*.js'</span>],[<span class="string">'bundle'</span>]);
        watcher.on(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>{
                <span class="built_in">console</span>.log(event.path + <span class="string">' was '</span> + event.type + <span class="string">', bundle again...'</span>);
        });
});

gulp.task(<span class="string">'default'</span>,[<span class="string">'bundle'</span>,<span class="string">'connect'</span>,<span class="string">'watch'</span>]);
</code></pre>
<p>就是这样一个gulpfile.js文件，帮我们实现了:</p>
<ol>
<li>先将es6和jsx编译成es5（反正是浏览器可以读懂的js）;</li>
<li>再将代码打包成dist目录下的bundle.js并丑化之（当然，如果在开发过程中没有丑化代码的需求的话也可以不要这一步），所以在html文件中就只需要引用bundle这个js文件就可以了:);</li>
<li>最后实现对代码的监听，若发生变动则自动重新打包再刷新浏览器，对手动刷新say goodbye，纵享丝滑。  </li>
</ol>
<p>这里注意到在bundle任务中有一行任务被注释掉了，解释一下：因为项目依赖了React（react + react-dom），所以当执行完一次bundle任务后，在不压缩的情况下，打包成的bundle.js有1M左右，压缩后也有200k。这行被注释掉的代码，其作用就是在打包的时候忽略依赖的库或框架，这样就能大大缩小打包结果文件的体积，但是如果要这么做，你需要：  </p>
<ul>
<li>在html文件中用script标签引入被忽略模块</li>
<li>为package.json文件增加配置，说明需要忽略的模块。  </li>
</ul>
<p>将所有的任务写在一个名为<strong>default</strong>的gulp任务内，保证在命令行只需要敲一个<strong>gulp</strong>就可以执行所有的任务。  </p>
<h3 id="Gulp！"><a href="#Gulp！" class="headerlink" title="Gulp！"></a>Gulp！</h3><p>现在已经完成了所有的工作了，接下来的事情就交给gulp去做吧。<br>进入项目目录，输入命令：<strong>gulp</strong><br>现在你就可以专心于coding啦。  </p>
<h3 id="What-U-Always-Need-to-Do-↓"><a href="#What-U-Always-Need-to-Do-↓" class="headerlink" title="What U Always Need to Do ↓"></a>What U Always Need to Do ↓</h3><ol>
<li>Make sure u have installed Nodejs  </li>
<li>Use <del>npm init</del> <strong>cnpm init</strong> to initialize ur project  </li>
<li>Install gulp  </li>
<li>Install the gulp plugins u need  </li>
<li>Edit ur <strong>gulpfile.js</strong>  </li>
<li>Run <strong>gulp</strong></li>
</ol>

  </section>

  
  
</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/huno/js/jquery.min.js"></script>
    <script src="/huno/js/main.js"></script>
    <script src="/huno/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/huno/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
